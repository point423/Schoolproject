# 校园选课系统 v1.1.0 - 使用说明

## 1. 数据库初始化脚本执行说明

### 1.1 开发环境（H2 内存数据库）



* 系统自动执行初始化脚本，无需手动操作

* 脚本路径：


  * 表结构：`src/main/resources/db/schema.sql`

  * 测试数据：`src/main/resources/db/data.sql`

* 配置位置：`application.yml` 和 `application-dev.yml` 中 `spring.sql.init` 相关配置

### 1.2 生产环境（MySQL 数据库）

需手动执行以下步骤：



1. 创建数据库：



```
CREATE DATABASE IF NOT EXISTS course\_db CHARACTER SET utf8mb4 COLLATE utf8mb4\_unicode\_ci;
```



1. 执行表结构脚本：



```
mysql -u root -p course\_db < src/main/resources/db/schema.sql
```



1. 执行测试数据脚本：



```
mysql -u root -p course\_db < src/main/resources/db/data.sql
```

## 2. 系统使用说明

### 2.1 环境要求



* JDK：17 或更高版本

* 构建工具：Maven 3.6+ 或 Gradle 7.0+

* 数据库（生产环境）：MySQL 8.0

### 2.2 配置修改

#### 2.2.1 开发环境配置（默认）



* 配置文件：`src/main/resources/application-dev.yml`

* 默认使用 H2 内存数据库，无需额外配置

* H2 控制台访问：


  * 地址：[http://localhost:80](http://localhost:8080/h2-console)[80/h2](http://localhost:8080/h2-console)[-cons](http://localhost:8080/h2-console)[ole](http://localhost:8080/h2-console)

  * 连接信息：


    * JDBC URL: `jdbc:h2:mem:course_db`

    * 用户名: `sa`

    * 密码：空

#### 2.2.2 生产环境配置



* 配置文件：`src/main/resources/application-prod.yml`

* 修改 MySQL 连接信息：



```
spring:

&#x20; datasource:

&#x20;   url: jdbc:mysql://localhost:3306/course\_db?useSSL=false\&serverTimezone=UTC\&allowPublicKeyRetrieval=true

&#x20;   username: 你的数据库用户名

&#x20;   password: 你的数据库密码
```



***

### 2.3 系统启动（核心）

#### 方式一：通过 Maven 启动（推荐）

##### ▶ 开发环境（默认）

直接启动（无需额外参数）：



```
mvn spring-boot:run
```

或显式指定环境：



```
mvn spring-boot:run "-Dspring-boot.run.profiles=dev"
```

##### ▶ 生产环境



```
mvn spring-boot:run "-Dspring-boot.run.profiles=prod"
```

> 注意：Windows PowerShell 中需用引号包裹含 
>
> `.`
>
>  的参数，确保 Maven 正确识别：



```
mvn spring-boot:run -D"spring-boot.run.profiles=prod" -e
```



***

### 2.4 系统访问

#### 2.4.1 核心接口



* 健康检查接口（验证数据库连接）：[http://localhost](http://localhost:8080/health/db)[:8080/](http://localhost:8080/health/db)[healt](http://localhost:8080/health/db)[h/db](http://localhost:8080/health/db)

* 返回示例：



```
{

&#x20; "status": "UP",

&#x20; "db\_type": "H2",

&#x20; "db\_version": "2.2.224",

&#x20; "message": "数据库连接成功"

}
```

#### 2.4.2 API 文档



* Swagger UI 地址：[http://localhost:80](http://localhost:8080/swagger-ui.html)[80/sw](http://localhost:8080/swagger-ui.html)[agger](http://localhost:8080/swagger-ui.html)[-ui.h](http://localhost:8080/swagger-ui.html)[tml](http://localhost:8080/swagger-ui.html)

* 核心模块接口前缀：


  * 课程管理：`/api/courses`

  * 学生管理：`/api/students`

  * 选课管理：`/api/enrollments`

#### 2.4.3 H2 数据库控制台（仅开发环境）



* 访问地址：[http://localhost](http://localhost:8080/h2-console)[:8080](http://localhost:8080/h2-console)[/h2-c](http://localhost:8080/h2-console)[onsol](http://localhost:8080/h2-console)[e](http://localhost:8080/h2-console)

* 功能：连接后可直接查看 / 操作数据库表及数据

### 2.5 初始测试数据

系统启动后默认内置以下测试数据：

#### 课程数据



* 计算机基础（CS-101）：周一 08:30-10:00，李教授

* 高等数学（MA-202）：周三 14:00-15:30，王教授

#### 学生数据



* 张三（学号 2023001）：计算机科学专业，2023 级

* 李四（学号 2023002）：数学与应用数学专业，2023 级

#### 选课数据



* 张三选了计算机基础

* 李四选了高等数学

## 3. 常见问题与解决方法



1. **生产环境数据库初始化**：需提前手动创建数据库并执行脚本，不可省略。

2. **SQL 语法兼容**：`schema.sql` 优先适配 H2 语法，MySQL 不兼容部分已标注 `TODO`，生产时需手动修改。

3. **测试类扫描问题**：`CourseRepositoryTest` 需添加注解 `@ContextConfiguration(classes = CourseApplication.class)`，指定主启动类以解决扫描不到配置的报错。

4. **数据库版本查询兼容**：H2 不支持 `SELECT VERSION()`，已通过条件判断处理：`String sql = "H2".equals(dbProduct) ? "SELECT H2VERSION()" : "SELECT VERSION()"`。

5. **字段映射错误**：`Schedule` 类的 `dayOfWeek` 字段需添加 `@Column(name = "SCHEDULE_DAY")`，明确数据库列名映射，避免插入 NULL。

6. **Windows 环境 Maven 参数问题**：PowerShell 中需用引号包裹含 `.` 的参数（如 `-D"spring-boot.run.profiles=prod"`）。

7. **JPQL 查询歧义**：`findByEnrolledLessThanCapacity` 方法需通过 `@Query("SELECT c FROM Course c WHERE c.enrolled < c.capacity")` 明确字段比较逻辑，避免框架误解析为 “字段 vs 外部参数”。

